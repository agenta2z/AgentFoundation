<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Skill Composition &#8212; OpenClaw Technical Documentation 2026.2.23 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=12dfc556" />
    <script src="../_static/documentation_options.js?v=54c96c00"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Channel System" href="../channels/index.html" />
    <link rel="prev" title="Skill Eligibility" href="skill-eligibility.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="skill-composition">
<span id="id1"></span><h1>Skill Composition<a class="headerlink" href="#skill-composition" title="Link to this heading">¶</a></h1>
<p>Multiple skills are composed additively into the agent’s system prompt. The
composition pipeline filters, orders, and formats skills within token budget
constraints.</p>
<section id="filtering-pipeline">
<h2>Filtering Pipeline<a class="headerlink" href="#filtering-pipeline" title="Link to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">filterSkillEntries()</span></code> function applies these filters in order:</p>
<ol class="arabic simple">
<li><p><strong>Eligibility filter</strong>: <code class="docutils literal notranslate"><span class="pre">shouldIncludeSkill()</span></code> removes skills that fail
OS, binary, env, or config checks (see <a class="reference internal" href="skill-eligibility.html"><span class="doc">Skill Eligibility</span></a>)</p></li>
<li><p><strong>Agent skill filter</strong>: If the agent config has a <code class="docutils literal notranslate"><span class="pre">skillFilter</span></code> list,
only skills whose names appear in the list are kept</p></li>
</ol>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span><span class="w"> </span><span class="nx">filterSkillEntries</span><span class="p">(</span>
<span class="w">  </span><span class="nx">entries</span><span class="o">:</span><span class="w"> </span><span class="kt">SkillEntry</span><span class="p">[],</span>
<span class="w">  </span><span class="nx">config?</span><span class="o">:</span><span class="w"> </span><span class="kt">OpenClawConfig</span><span class="p">,</span>
<span class="w">  </span><span class="nx">skillFilter?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[],</span>
<span class="w">  </span><span class="nx">eligibility?</span><span class="o">:</span><span class="w"> </span><span class="kt">SkillEligibilityContext</span><span class="p">,</span>
<span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">SkillEntry</span><span class="p">[]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">skillFilter</span></code> is normalized via <code class="docutils literal notranslate"><span class="pre">normalizeSkillFilter()</span></code> from
<code class="docutils literal notranslate"><span class="pre">src/agents/skills/filter.ts</span></code>, which handles case-insensitive matching and
deduplication.</p>
<p>Source: <code class="docutils literal notranslate"><span class="pre">src/agents/skills/workspace.ts:67-88</span></code></p>
</section>
<section id="prompt-formatting">
<h2>Prompt Formatting<a class="headerlink" href="#prompt-formatting" title="Link to this heading">¶</a></h2>
<p>After filtering, eligible skills are formatted for the system prompt:</p>
<ol class="arabic simple">
<li><p>Extract <code class="docutils literal notranslate"><span class="pre">Skill</span></code> objects from <code class="docutils literal notranslate"><span class="pre">SkillEntry[]</span></code></p></li>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">formatSkillsForPrompt()</span></code> (from <code class="docutils literal notranslate"><span class="pre">&#64;mariozechner/pi-coding-agent</span></code>)
which concatenates skill names, file paths, and prompt content</p></li>
<li><p>Apply <code class="docutils literal notranslate"><span class="pre">compactSkillPaths()</span></code> to replace home directory prefixes with <code class="docutils literal notranslate"><span class="pre">~</span></code></p></li>
</ol>
<section id="path-compaction">
<h3>Path Compaction<a class="headerlink" href="#path-compaction" title="Link to this heading">¶</a></h3>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Before: /Users/alice/.bun/install/global/node_modules/openclaw/skills/github/SKILL.md
After:  ~/.bun/install/global/node_modules/openclaw/skills/github/SKILL.md
</pre></div>
</div>
<p>This saves ~5-6 tokens per skill path. Across 50+ skills, that’s approximately
400-600 tokens saved. The LLM understands <code class="docutils literal notranslate"><span class="pre">~</span></code> expansion, and the <code class="docutils literal notranslate"><span class="pre">read</span></code>
tool resolves <code class="docutils literal notranslate"><span class="pre">~</span></code> to the home directory at runtime.</p>
<p>Source: <code class="docutils literal notranslate"><span class="pre">src/agents/skills/workspace.ts:45-53</span></code></p>
</section>
</section>
<section id="token-budgeting">
<h2>Token Budgeting<a class="headerlink" href="#token-budgeting" title="Link to this heading">¶</a></h2>
<p>The system uses a binary search approach to find the largest set of skills
that fits within the character budget:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 40.0%" />
<col style="width: 20.0%" />
<col style="width: 40.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DEFAULT_MAX_SKILLS_IN_PROMPT</span></code></p></td>
<td><p>150</p></td>
<td><p>Max number of skills in prompt</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DEFAULT_MAX_SKILLS_PROMPT_CHARS</span></code></p></td>
<td><p>30,000</p></td>
<td><p>Max total characters for skills text</p></td>
</tr>
</tbody>
</table>
<p>If the total formatted prompt exceeds <code class="docutils literal notranslate"><span class="pre">maxSkillsPromptChars</span></code>, skills are
trimmed from the end until the budget is met. Priority is determined by source
order (higher-precedence sources appear first).</p>
</section>
<section id="workspace-synchronization">
<h2>Workspace Synchronization<a class="headerlink" href="#workspace-synchronization" title="Link to this heading">¶</a></h2>
<p>For sandboxed agent execution, skills need to be available inside the sandbox.
The <code class="docutils literal notranslate"><span class="pre">syncSkillsToWorkspace()</span></code> function copies all resolved skill directories
to a target workspace path:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Source: ~/.openclaw/skills/weather/SKILL.md
Target: &lt;sandbox-workspace&gt;/skills/weather/SKILL.md
</pre></div>
</div>
<p>This ensures sandboxed agents have access to the same skills as the host
agent, without requiring filesystem access outside the sandbox.</p>
</section>
<section id="snapshot-system">
<h2>Snapshot System<a class="headerlink" href="#snapshot-system" title="Link to this heading">¶</a></h2>
<p>When a session begins, a <code class="docutils literal notranslate"><span class="pre">SkillSnapshot</span></code> is created and stored
with the session entry. This captures:</p>
<ul class="simple">
<li><p>The formatted prompt text</p></li>
<li><p>List of skill names with their <code class="docutils literal notranslate"><span class="pre">primaryEnv</span></code> and <code class="docutils literal notranslate"><span class="pre">requiredEnv</span></code></p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">skillFilter</span></code> applied</p></li>
<li><p>A version number for cache invalidation</p></li>
</ul>
<p>Snapshots ensure consistent skill availability across a conversation session,
even if skills are modified on disk mid-conversation.</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="kr">type</span><span class="w"> </span><span class="nx">SkillSnapshot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">prompt</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">skills</span><span class="o">:</span><span class="w"> </span><span class="kt">Array</span><span class="o">&lt;</span><span class="p">{</span>
<span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">    </span><span class="nx">primaryEnv?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">    </span><span class="nx">requiredEnv?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[];</span>
<span class="w">  </span><span class="p">}</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="nx">skillFilter?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[];</span>
<span class="w">  </span><span class="nx">resolvedSkills?</span><span class="o">:</span><span class="w"> </span><span class="kt">Skill</span><span class="p">[];</span>
<span class="w">  </span><span class="nx">version?</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Source: <code class="docutils literal notranslate"><span class="pre">src/agents/skills/types.ts:82-89</span></code></p>
</section>
<section id="composition-example">
<h2>Composition Example<a class="headerlink" href="#composition-example" title="Link to this heading">¶</a></h2>
<p>Given an agent with <code class="docutils literal notranslate"><span class="pre">skillFilter:</span> <span class="pre">[&quot;weather&quot;,</span> <span class="pre">&quot;github&quot;,</span> <span class="pre">&quot;exec&quot;]</span></code>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>1. Load from 6 sources:
   - Bundled: weather, github, exec, spotify, discord, ... (50+)
   - Workspace: (none)

2. Filter by eligibility:
   - spotify: excluded (requires spotify_player binary)
   - discord: included

3. Filter by skillFilter:
   - Only weather, github, exec kept

4. Format for prompt:
   - weather SKILL.md content (~500 chars)
   - github SKILL.md content (~2000 chars)
   - exec SKILL.md content (~800 chars)
   - Total: ~3300 chars (well within 30,000 budget)

5. Compact paths:
   - /Users/alice/.bun/.../weather/SKILL.md → ~/.bun/.../weather/SKILL.md

6. Inject into system prompt
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">OpenClaw Technical Documentation</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../architecture/index.html">Architecture Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../orchestration/index.html">Orchestration Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../knowledge/index.html">Knowledge System Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Skills System</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#what-skills-do">What Skills Do</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#how-skills-work">How Skills Work</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#bundled-skills-catalog">Bundled Skills Catalog</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="skill-definition.html">Skill Definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="skill-discovery.html">Skill Discovery</a></li>
<li class="toctree-l3"><a class="reference internal" href="skill-execution.html">Skill Execution</a></li>
<li class="toctree-l3"><a class="reference internal" href="skill-eligibility.html">Skill Eligibility</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Skill Composition</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../channels/index.html">Channel System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gateway/index.html">Gateway Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins/index.html">Plugin System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure/index.html">Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Skills System</a><ul>
      <li>Previous: <a href="skill-eligibility.html" title="previous chapter">Skill Eligibility</a></li>
      <li>Next: <a href="../channels/index.html" title="next chapter">Channel System</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024-2026, OpenClaw Contributors.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../_sources/skills/skill-composition.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>