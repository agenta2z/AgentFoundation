<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>How Knowledge is Created &#8212; OpenClaw Technical Documentation 2026.2.23 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=12dfc556" />
    <script src="../_static/documentation_options.js?v=54c96c00"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="SQLite Storage Schema" href="knowledge-storage.html" />
    <link rel="prev" title="Architecture Deep-Dive" href="memory-architecture.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="how-knowledge-is-created">
<h1>How Knowledge is Created<a class="headerlink" href="#how-knowledge-is-created" title="Link to this heading">¶</a></h1>
<p>OpenClaw’s knowledge base is populated from two sources: agent-written memory
files and session transcript indexing.  This page covers both mechanisms and
the memory-flush system that bridges session context into persistent storage.</p>
<nav class="contents local" id="on-this-page">
<p class="topic-title">On this page</p>
<ul class="simple">
<li><p><a class="reference internal" href="#agent-written-memory-files" id="id1">Agent-Written Memory Files</a></p>
<ul>
<li><p><a class="reference internal" href="#evergreen-memory-memory-md" id="id2">Evergreen Memory (<code class="docutils literal notranslate"><span class="pre">MEMORY.md</span></code>)</a></p></li>
<li><p><a class="reference internal" href="#episodic-memory-memory-yyyy-mm-dd-md" id="id3">Episodic Memory (<code class="docutils literal notranslate"><span class="pre">memory/YYYY-MM-DD.md</span></code>)</a></p></li>
<li><p><a class="reference internal" href="#additional-paths" id="id4">Additional Paths</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#memory-flush" id="id5">Memory Flush</a></p>
<ul>
<li><p><a class="reference internal" href="#when-it-triggers" id="id6">When It Triggers</a></p></li>
<li><p><a class="reference internal" href="#the-prompt" id="id7">The Prompt</a></p></li>
<li><p><a class="reference internal" href="#configuration" id="id8">Configuration</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#session-transcript-indexing" id="id9">Session Transcript Indexing</a></p>
<ul>
<li><p><a class="reference internal" href="#building-session-entries" id="id10">Building Session Entries</a></p></li>
<li><p><a class="reference internal" href="#incremental-session-sync" id="id11">Incremental Session Sync</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="agent-written-memory-files">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Agent-Written Memory Files</a><a class="headerlink" href="#agent-written-memory-files" title="Link to this heading">¶</a></h2>
<p>The agent writes knowledge into Markdown files within the workspace directory.
Two file patterns are recognized:</p>
<section id="evergreen-memory-memory-md">
<h3><a class="toc-backref" href="#id2" role="doc-backlink">Evergreen Memory (<code class="docutils literal notranslate"><span class="pre">MEMORY.md</span></code>)</a><a class="headerlink" href="#evergreen-memory-memory-md" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>Located at the workspace root: <code class="docutils literal notranslate"><span class="pre">MEMORY.md</span></code> or <code class="docutils literal notranslate"><span class="pre">memory.md</span></code>.</p></li>
<li><p>Contains durable facts, preferences, and long-lived context.</p></li>
<li><p>The agent updates this file directly via tool calls.</p></li>
<li><p><strong>Not subject to temporal decay</strong> – evergreen files are treated as always
current during retrieval scoring.</p></li>
</ul>
</section>
<section id="episodic-memory-memory-yyyy-mm-dd-md">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Episodic Memory (<code class="docutils literal notranslate"><span class="pre">memory/YYYY-MM-DD.md</span></code>)</a><a class="headerlink" href="#episodic-memory-memory-yyyy-mm-dd-md" title="Link to this heading">¶</a></h3>
<ul>
<li><p>Located in the <code class="docutils literal notranslate"><span class="pre">memory/</span></code> subdirectory, one file per date.</p></li>
<li><p>Contains daily observations, decisions, and events.</p></li>
<li><p>Created by the agent during memory flush or on explicit instruction.</p></li>
<li><p><strong>Subject to temporal decay</strong> – the date in the filename is parsed and
used to calculate recency scores.  The regex for extraction:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>/(?:^|\/)memory\/(\d{4})-(\d{2})-(\d{2})\.md$/
</pre></div>
</div>
</li>
<li><p>Files outside this naming pattern in <code class="docutils literal notranslate"><span class="pre">memory/</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">memory/topics.md</span></code>)
are treated as evergreen and do not decay.</p></li>
</ul>
</section>
<section id="additional-paths">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Additional Paths</a><a class="headerlink" href="#additional-paths" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">extraPaths</span></code> configuration allows indexing Markdown files from
directories outside the workspace (e.g. shared knowledge bases).  These
paths are resolved relative to the workspace and normalized in
<code class="docutils literal notranslate"><span class="pre">normalizeExtraMemoryPaths()</span></code>.</p>
</section>
</section>
<section id="memory-flush">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Memory Flush</a><a class="headerlink" href="#memory-flush" title="Link to this heading">¶</a></h2>
<p>The memory flush is a pre-compaction mechanism that gives the agent an
opportunity to persist important context before the session’s conversation
history is compressed.</p>
<p>Source: <code class="docutils literal notranslate"><span class="pre">src/auto-reply/reply/memory-flush.ts</span></code></p>
<section id="when-it-triggers">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">When It Triggers</a><a class="headerlink" href="#when-it-triggers" title="Link to this heading">¶</a></h3>
<p>The function <code class="docutils literal notranslate"><span class="pre">shouldRunMemoryFlush()</span></code> returns <code class="docutils literal notranslate"><span class="pre">true</span></code> when all conditions
are met:</p>
<ol class="arabic">
<li><p>Memory flush is enabled (default: <code class="docutils literal notranslate"><span class="pre">true</span></code>).</p></li>
<li><p>The session’s <code class="docutils literal notranslate"><span class="pre">totalTokens</span></code> (or <code class="docutils literal notranslate"><span class="pre">totalTokensFresh</span></code>) exceeds a
threshold computed as:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>threshold = contextWindowTokens - reserveTokensFloor - softThresholdTokens
</pre></div>
</div>
</li>
<li><p>The flush has not already run at the current <code class="docutils literal notranslate"><span class="pre">compactionCount</span></code>.</p></li>
</ol>
<p><strong>Default values:</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 66.7%" />
<col style="width: 33.3%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">softThresholdTokens</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">4000</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">reserveTokensFloor</span></code></p></td>
<td><p>From <code class="docutils literal notranslate"><span class="pre">DEFAULT_PI_COMPACTION_RESERVE_TOKENS_FLOOR</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">enabled</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">true</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="the-prompt">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">The Prompt</a><a class="headerlink" href="#the-prompt" title="Link to this heading">¶</a></h3>
<p>When a flush is triggered, the agent receives a system message and a user
message:</p>
<p><strong>System prompt</strong> (<code class="docutils literal notranslate"><span class="pre">DEFAULT_MEMORY_FLUSH_SYSTEM_PROMPT</span></code>):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Pre-compaction memory flush turn.
The session is near auto-compaction; capture durable memories to disk.
You may reply, but usually &lt;|silent|&gt; is correct.
</pre></div>
</div>
<p><strong>User prompt</strong> (<code class="docutils literal notranslate"><span class="pre">DEFAULT_MEMORY_FLUSH_PROMPT</span></code>):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Pre-compaction memory flush.
Store durable memories now (use memory/YYYY-MM-DD.md; create memory/ if needed).
IMPORTANT: If the file already exists, APPEND new content only and do
not overwrite existing entries.
If nothing to store, reply with &lt;|silent|&gt;.
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">YYYY-MM-DD</span></code> placeholder is replaced with the current date in the
user’s timezone (from <code class="docutils literal notranslate"><span class="pre">resolveCronStyleNow</span></code>).</p>
</section>
<section id="configuration">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Configuration</a><a class="headerlink" href="#configuration" title="Link to this heading">¶</a></h3>
<p>Memory flush is configurable under
<code class="docutils literal notranslate"><span class="pre">agents.defaults.compaction.memoryFlush</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">agents</span><span class="p">:</span>
<span class="w">  </span><span class="nt">defaults</span><span class="p">:</span>
<span class="w">    </span><span class="nt">compaction</span><span class="p">:</span>
<span class="w">      </span><span class="nt">memoryFlush</span><span class="p">:</span>
<span class="w">        </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">softThresholdTokens</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4000</span>
<span class="w">        </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;...&quot;</span><span class="w">          </span><span class="c1"># custom prompt (optional)</span>
<span class="w">        </span><span class="nt">systemPrompt</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;...&quot;</span><span class="w">    </span><span class="c1"># custom system prompt (optional)</span>
</pre></div>
</div>
</section>
</section>
<section id="session-transcript-indexing">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">Session Transcript Indexing</a><a class="headerlink" href="#session-transcript-indexing" title="Link to this heading">¶</a></h2>
<p>When the <code class="docutils literal notranslate"><span class="pre">sources</span></code> configuration includes <code class="docutils literal notranslate"><span class="pre">&quot;sessions&quot;</span></code>, OpenClaw indexes
session transcript files (<code class="docutils literal notranslate"><span class="pre">~/.openclaw/agents/&lt;agentId&gt;/sessions/*.jsonl</span></code>)
alongside memory files.</p>
<p>Source: <code class="docutils literal notranslate"><span class="pre">src/memory/session-files.ts</span></code></p>
<section id="building-session-entries">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Building Session Entries</a><a class="headerlink" href="#building-session-entries" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">buildSessionEntry()</span></code> function transforms a JSONL transcript into an
indexable text document:</p>
<ol class="arabic simple">
<li><p>Read the <code class="docutils literal notranslate"><span class="pre">.jsonl</span></code> file line by line.</p></li>
<li><p>Filter for lines with <code class="docutils literal notranslate"><span class="pre">type:</span> <span class="pre">&quot;message&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">role:</span> <span class="pre">&quot;user&quot;</span></code> or
<code class="docutils literal notranslate"><span class="pre">role:</span> <span class="pre">&quot;assistant&quot;</span></code>.</p></li>
<li><p>Extract text content via <code class="docutils literal notranslate"><span class="pre">extractSessionText()</span></code> – handles both plain
string content and structured <code class="docutils literal notranslate"><span class="pre">[{</span> <span class="pre">type:</span> <span class="pre">&quot;text&quot;,</span> <span class="pre">text:</span> <span class="pre">&quot;...&quot;</span> <span class="pre">}]</span></code> arrays.</p></li>
<li><p>Apply <code class="docutils literal notranslate"><span class="pre">redactSensitiveText()</span></code> to strip credentials and secrets.</p></li>
<li><p>Format each message as <code class="docutils literal notranslate"><span class="pre">&quot;User:</span> <span class="pre">&lt;text&gt;&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;Assistant:</span> <span class="pre">&lt;text&gt;&quot;</span></code>.</p></li>
<li><p>Build a <code class="docutils literal notranslate"><span class="pre">lineMap</span></code> that maps each output line back to its 1-indexed
JSONL source line (used for accurate citation line numbers).</p></li>
</ol>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="k">export</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="nx">SessionFileEntry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w">       </span><span class="c1">// &quot;sessions/&lt;filename&gt;&quot;</span>
<span class="w">  </span><span class="nx">absPath</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w">    </span><span class="c1">// absolute filesystem path</span>
<span class="w">  </span><span class="nx">mtimeMs</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">  </span><span class="nx">size</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">  </span><span class="nx">hash</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w">       </span><span class="c1">// hash of content + lineMap</span>
<span class="w">  </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w">    </span><span class="c1">// &quot;User: ...\nAssistant: ...&quot; text</span>
<span class="w">  </span><span class="nx">lineMap</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">[];</span><span class="w">  </span><span class="c1">// content line -&gt; JSONL line number mapping</span>
<span class="p">};</span>
</pre></div>
</div>
</section>
<section id="incremental-session-sync">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">Incremental Session Sync</a><a class="headerlink" href="#incremental-session-sync" title="Link to this heading">¶</a></h3>
<p>Session files grow continuously as conversations progress.  The sync system
uses a delta-tracking mechanism to avoid re-indexing on every append:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">onSessionTranscriptUpdate</span></code> emits an event when a transcript file is
written to.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">scheduleSessionDirty()</span></code> method debounces (5 seconds) and batches
pending file notifications.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">processSessionDeltaBatch()</span></code> computes how many new bytes and how many
new messages (newlines) have been appended since the last sync.</p></li>
<li><p>A sync is triggered only when either <code class="docutils literal notranslate"><span class="pre">deltaBytes</span></code> or <code class="docutils literal notranslate"><span class="pre">deltaMessages</span></code>
thresholds are exceeded.</p></li>
<li><p>After indexing, <code class="docutils literal notranslate"><span class="pre">resetSessionDelta()</span></code> resets the counters.</p></li>
</ol>
<p>This ensures that a rapid series of messages does not cause excessive
re-indexing while still keeping the index reasonably current.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">OpenClaw Technical Documentation</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../architecture/index.html">Architecture Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../orchestration/index.html">Orchestration Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Knowledge System Overview</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#big-picture">Big Picture</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#knowledge-lifecycle">Knowledge Lifecycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#dual-backend-architecture">Dual-Backend Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#graceful-degradation-chain">Graceful Degradation Chain</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#class-hierarchy">Class Hierarchy</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#memory-v2-research-direction">Memory v2 Research Direction</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="memory-architecture.html">Architecture Deep-Dive</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">How Knowledge is Created</a></li>
<li class="toctree-l3"><a class="reference internal" href="knowledge-storage.html">SQLite Storage Schema</a></li>
<li class="toctree-l3"><a class="reference internal" href="knowledge-retrieval.html">Retrieval Pipeline</a></li>
<li class="toctree-l3"><a class="reference internal" href="embeddings.html">Embedding Providers &amp; Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="qmd-backend.html">External QMD Backend</a></li>
<li class="toctree-l3"><a class="reference internal" href="memory-tools.html">Memory Tools</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../skills/index.html">Skills System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../channels/index.html">Channel System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gateway/index.html">Gateway Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins/index.html">Plugin System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure/index.html">Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Knowledge System Overview</a><ul>
      <li>Previous: <a href="memory-architecture.html" title="previous chapter">Architecture Deep-Dive</a></li>
      <li>Next: <a href="knowledge-storage.html" title="next chapter">SQLite Storage Schema</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024-2026, OpenClaw Contributors.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../_sources/knowledge/knowledge-creation.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>