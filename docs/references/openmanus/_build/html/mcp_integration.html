<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MCP Integration &#8212; OpenManus 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=12dfc556" />
    <script src="_static/documentation_options.js?v=01f34227"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Sandbox System" href="sandbox_system.html" />
    <link rel="prev" title="Configuration" href="configuration.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="mcp-integration">
<h1>MCP Integration<a class="headerlink" href="#mcp-integration" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#overview" id="id1">Overview</a></p></li>
<li><p><a class="reference internal" href="#mcp-client" id="id2">MCP Client</a></p>
<ul>
<li><p><a class="reference internal" href="#mcpclients" id="id3">MCPClients</a></p>
<ul>
<li><p><a class="reference internal" href="#connection-methods" id="id4">Connection Methods</a></p></li>
<li><p><a class="reference internal" href="#tool-discovery" id="id5">Tool Discovery</a></p></li>
<li><p><a class="reference internal" href="#tool-name-sanitization" id="id6">Tool Name Sanitization</a></p></li>
<li><p><a class="reference internal" href="#disconnection" id="id7">Disconnection</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#mcpclienttool" id="id8">MCPClientTool</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#mcp-server" id="id9">MCP Server</a></p>
<ul>
<li><p><a class="reference internal" href="#tool-registration" id="id10">Tool Registration</a></p></li>
<li><p><a class="reference internal" href="#running-the-server" id="id11">Running the Server</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#mcp-agent" id="id12">MCP Agent</a></p>
<ul>
<li><p><a class="reference internal" href="#key-features" id="id13">Key Features</a></p></li>
<li><p><a class="reference internal" href="#error-handling" id="id14">Error Handling</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#mcp-in-manus-agent" id="id15">MCP in Manus Agent</a></p></li>
<li><p><a class="reference internal" href="#configuration" id="id16">Configuration</a></p></li>
<li><p><a class="reference internal" href="#running-with-mcp" id="id17">Running with MCP</a></p></li>
</ul>
</nav>
<section id="overview">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Overview</a><a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>OpenManus has <strong>both client and server</strong> implementations for the
<a class="reference external" href="https://modelcontextprotocol.io/">Model Context Protocol (MCP)</a>.
MCP enables standardized communication between LLM applications and
external tool providers.</p>
<ul class="simple">
<li><p><strong>MCP Client</strong>: Connects to external MCP servers to discover and
use their tools dynamically</p></li>
<li><p><strong>MCP Server</strong>: Exposes OpenManus tools (Bash, Browser, Editor) as
an MCP-compatible server for other applications to use</p></li>
</ul>
</section>
<section id="mcp-client">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">MCP Client</a><a class="headerlink" href="#mcp-client" title="Link to this heading">¶</a></h2>
<p><strong>File</strong>: <code class="docutils literal notranslate"><span class="pre">app/tool/mcp.py</span></code></p>
<p>The MCP client system consists of two classes: <code class="docutils literal notranslate"><span class="pre">MCPClients</span></code> (connection
manager) and <code class="docutils literal notranslate"><span class="pre">MCPClientTool</span></code> (tool proxy).</p>
<section id="mcpclients">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">MCPClients</a><a class="headerlink" href="#mcpclients" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">MCPClients</span></code> extends <code class="docutils literal notranslate"><span class="pre">ToolCollection</span></code> to manage connections to
multiple MCP servers simultaneously:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">MCPClients</span><span class="p">(</span><span class="n">ToolCollection</span><span class="p">):</span>
    <span class="n">sessions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ClientSession</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">exit_stacks</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">AsyncExitStack</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
<section id="connection-methods">
<h4><a class="toc-backref" href="#id4" role="doc-backlink">Connection Methods</a><a class="headerlink" href="#connection-methods" title="Link to this heading">¶</a></h4>
<p><strong>SSE (Server-Sent Events)</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">await</span> <span class="n">mcp_clients</span><span class="o">.</span><span class="n">connect_sse</span><span class="p">(</span>
    <span class="n">server_url</span><span class="o">=</span><span class="s2">&quot;http://localhost:8080/sse&quot;</span><span class="p">,</span>
    <span class="n">server_id</span><span class="o">=</span><span class="s2">&quot;my-server&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p><strong>Stdio (Standard I/O)</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">await</span> <span class="n">mcp_clients</span><span class="o">.</span><span class="n">connect_stdio</span><span class="p">(</span>
    <span class="n">command</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">,</span>
    <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;my_mcp_server.py&quot;</span><span class="p">],</span>
    <span class="n">server_id</span><span class="o">=</span><span class="s2">&quot;local-server&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="tool-discovery">
<h4><a class="toc-backref" href="#id5" role="doc-backlink">Tool Discovery</a><a class="headerlink" href="#tool-discovery" title="Link to this heading">¶</a></h4>
<p>After connecting, tools are automatically discovered:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>connect_sse/connect_stdio
     │
     ▼
session.initialize()
     │
     ▼
session.list_tools()
     │
     ▼
For each remote tool:
     │
     ├── Create MCPClientTool proxy
     │     name = &quot;mcp_{server_id}_{original_name}&quot;
     │     description = tool.description
     │     parameters = tool.inputSchema
     │     session = active_session
     │
     └── Register in tool_map
</pre></div>
</div>
</section>
<section id="tool-name-sanitization">
<h4><a class="toc-backref" href="#id6" role="doc-backlink">Tool Name Sanitization</a><a class="headerlink" href="#tool-name-sanitization" title="Link to this heading">¶</a></h4>
<p>Tool names are sanitized for compatibility:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_sanitize_tool_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="c1"># Replace invalid characters with underscores</span>
    <span class="n">sanitized</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[^a-zA-Z0-9_-]&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="c1"># Remove consecutive underscores</span>
    <span class="n">sanitized</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;_+&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">sanitized</span><span class="p">)</span>
    <span class="c1"># Truncate to 64 characters</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sanitized</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">64</span><span class="p">:</span>
        <span class="n">sanitized</span> <span class="o">=</span> <span class="n">sanitized</span><span class="p">[:</span><span class="mi">64</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">sanitized</span>
</pre></div>
</div>
</section>
<section id="disconnection">
<h4><a class="toc-backref" href="#id7" role="doc-backlink">Disconnection</a><a class="headerlink" href="#disconnection" title="Link to this heading">¶</a></h4>
<p>Clean disconnection with resource cleanup:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Disconnect specific server</span>
<span class="k">await</span> <span class="n">mcp_clients</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="s2">&quot;my-server&quot;</span><span class="p">)</span>

<span class="c1"># Disconnect all servers</span>
<span class="k">await</span> <span class="n">mcp_clients</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="mcpclienttool">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">MCPClientTool</a><a class="headerlink" href="#mcpclienttool" title="Link to this heading">¶</a></h3>
<p>Proxy tool that forwards execution to remote MCP servers:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">MCPClientTool</span><span class="p">(</span><span class="n">BaseTool</span><span class="p">):</span>
    <span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ClientSession</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">server_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">original_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ToolResult</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ToolResult</span><span class="p">(</span><span class="n">error</span><span class="o">=</span><span class="s2">&quot;Not connected to MCP server&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">call_tool</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">original_name</span><span class="p">,</span> <span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="n">content_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">item</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">TextContent</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">ToolResult</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="n">content_str</span> <span class="ow">or</span> <span class="s2">&quot;No output returned.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="mcp-server">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">MCP Server</a><a class="headerlink" href="#mcp-server" title="Link to this heading">¶</a></h2>
<p><strong>File</strong>: <code class="docutils literal notranslate"><span class="pre">app/mcp/server.py</span></code></p>
<p>The MCP server exposes OpenManus tools for external consumption via
the <code class="docutils literal notranslate"><span class="pre">FastMCP</span></code> library.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">MCPServer</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;openmanus&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="n">FastMCP</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tools</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Bash</span><span class="p">(),</span>
            <span class="n">BrowserUseTool</span><span class="p">(),</span>
            <span class="n">StrReplaceEditor</span><span class="p">(),</span>
            <span class="n">Terminate</span><span class="p">(),</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">register_tool</span><span class="p">(</span><span class="n">tool</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transport</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;stdio&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">transport</span><span class="o">=</span><span class="n">transport</span><span class="p">)</span>
</pre></div>
</div>
<section id="tool-registration">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Tool Registration</a><a class="headerlink" href="#tool-registration" title="Link to this heading">¶</a></h3>
<p>The server dynamically creates async wrapper functions for each tool:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">register_tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool</span><span class="p">:</span> <span class="n">BaseTool</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Register a BaseTool as an MCP tool.&quot;&quot;&quot;</span>
    <span class="c1"># Build function signature from tool parameters</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">tool</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;properties&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">required</span> <span class="o">=</span> <span class="n">tool</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="p">[])</span>

    <span class="c1"># Create async wrapper with proper type annotations</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">tool_wrapper</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">tool</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="c1"># Register with FastMCP</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">tool</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="n">tool</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
    <span class="p">)(</span><span class="n">tool_wrapper</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="running-the-server">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">Running the Server</a><a class="headerlink" href="#running-the-server" title="Link to this heading">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>run_mcp_server.py

<span class="c1"># Or with explicit transport</span>
python<span class="w"> </span>run_mcp_server.py<span class="w"> </span>--transport<span class="w"> </span>stdio
</pre></div>
</div>
<p>The server supports stdio transport (default) for local integration.</p>
</section>
</section>
<section id="mcp-agent">
<h2><a class="toc-backref" href="#id12" role="doc-backlink">MCP Agent</a><a class="headerlink" href="#mcp-agent" title="Link to this heading">¶</a></h2>
<p><strong>File</strong>: <code class="docutils literal notranslate"><span class="pre">app/agent/mcp.py</span></code></p>
<p>The <code class="docutils literal notranslate"><span class="pre">MCPAgent</span></code> is a specialized <code class="docutils literal notranslate"><span class="pre">ToolCallAgent</span></code> that works
exclusively with MCP server tools.</p>
<section id="key-features">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">Key Features</a><a class="headerlink" href="#key-features" title="Link to this heading">¶</a></h3>
<ul>
<li><p><strong>Dynamic Tool Loading</strong>: Tools are loaded from MCP servers at init</p></li>
<li><p><strong>Periodic Refresh</strong>: Tools are refreshed every N steps to detect
schema changes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">_refresh_tools_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">think</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_step</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_tools_interval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_tools</span><span class="p">()</span>
    <span class="k">return</span> <span class="k">await</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">think</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p><strong>Multimedia Handling</strong>: Processes base64 image responses from MCP tools</p></li>
<li><p><strong>Graceful Shutdown</strong>: Detects when MCP service becomes unavailable
and terminates cleanly</p></li>
</ul>
</section>
<section id="error-handling">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">Error Handling</a><a class="headerlink" href="#error-handling" title="Link to this heading">¶</a></h3>
<p>The MCP agent includes specialized error prompts:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># From app/prompt/mcp.py</span>
<span class="n">TOOL_ERROR_PROMPT</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;The tool execution failed. &quot;</span>
    <span class="s2">&quot;Please check the error message and try again &quot;</span>
    <span class="s2">&quot;with corrected parameters.&quot;</span>
<span class="p">)</span>

<span class="n">MULTIMEDIA_RESPONSE_PROMPT</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;The tool returned multimedia content. &quot;</span>
    <span class="s2">&quot;Please describe what you see.&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="mcp-in-manus-agent">
<h2><a class="toc-backref" href="#id15" role="doc-backlink">MCP in Manus Agent</a><a class="headerlink" href="#mcp-in-manus-agent" title="Link to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">Manus</span></code> agent integrates MCP alongside its local tools:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># app/agent/manus.py</span>
<span class="nd">@classmethod</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Manus&quot;</span><span class="p">:</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Load MCP server configs</span>
    <span class="n">mcp_config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">mcp</span>
    <span class="k">if</span> <span class="n">mcp_config</span> <span class="ow">and</span> <span class="n">mcp_config</span><span class="o">.</span><span class="n">servers</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">server_config</span> <span class="ow">in</span> <span class="n">mcp_config</span><span class="o">.</span><span class="n">servers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">server_config</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;sse&quot;</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">instance</span><span class="o">.</span><span class="n">mcp_clients</span><span class="o">.</span><span class="n">connect_sse</span><span class="p">(</span>
                    <span class="n">server_url</span><span class="o">=</span><span class="n">server_config</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
                    <span class="n">server_id</span><span class="o">=</span><span class="n">server_config</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">server_config</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;stdio&quot;</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">instance</span><span class="o">.</span><span class="n">mcp_clients</span><span class="o">.</span><span class="n">connect_stdio</span><span class="p">(</span>
                    <span class="n">command</span><span class="o">=</span><span class="n">server_config</span><span class="o">.</span><span class="n">command</span><span class="p">,</span>
                    <span class="n">args</span><span class="o">=</span><span class="n">server_config</span><span class="o">.</span><span class="n">args</span><span class="p">,</span>
                    <span class="n">server_id</span><span class="o">=</span><span class="n">server_config</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="c1"># Add MCP tools to available tools</span>
        <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">instance</span><span class="o">.</span><span class="n">mcp_clients</span><span class="o">.</span><span class="n">tool_map</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">available_tools</span><span class="o">.</span><span class="n">add_tool</span><span class="p">(</span><span class="n">tool</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">instance</span>
</pre></div>
</div>
<p>This means the Manus agent can use both:</p>
<ul class="simple">
<li><p><strong>Local tools</strong>: PythonExecute, BrowserUseTool, StrReplaceEditor, etc.</p></li>
<li><p><strong>Remote MCP tools</strong>: Any tools provided by connected MCP servers</p></li>
</ul>
</section>
<section id="configuration">
<h2><a class="toc-backref" href="#id16" role="doc-backlink">Configuration</a><a class="headerlink" href="#configuration" title="Link to this heading">¶</a></h2>
<p>MCP servers are configured in <code class="docutils literal notranslate"><span class="pre">config/mcp.json</span></code>:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;mcpServers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;filesystem&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;http://localhost:3000/sse&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sse&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;database&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;npx&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;-y&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/server-sqlite&quot;</span><span class="p">,</span>
<span class="w">                     </span><span class="s2">&quot;path/to/db.sqlite&quot;</span><span class="p">],</span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;stdio&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The path to this file is specified in the main config:</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[mcp]</span>
<span class="n">config_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;config/mcp.json&quot;</span>
</pre></div>
</div>
</section>
<section id="running-with-mcp">
<h2><a class="toc-backref" href="#id17" role="doc-backlink">Running with MCP</a><a class="headerlink" href="#running-with-mcp" title="Link to this heading">¶</a></h2>
<p><strong>As a Client</strong> (connecting to external MCP servers):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Interactive mode</span>
python<span class="w"> </span>run_mcp.py<span class="w"> </span>--connection<span class="w"> </span>sse<span class="w"> </span>--interactive

<span class="c1"># With a specific prompt</span>
python<span class="w"> </span>run_mcp.py<span class="w"> </span>--connection<span class="w"> </span>stdio<span class="w"> </span>--prompt<span class="w"> </span><span class="s2">&quot;List files&quot;</span>
</pre></div>
</div>
<p><strong>As a Server</strong> (exposing OpenManus tools via MCP):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>run_mcp_server.py
</pre></div>
</div>
<p>Other MCP clients (e.g., Claude Desktop, Continue.dev) can then
connect to the OpenManus MCP server and use its tools.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">OpenManus</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">System Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="agent_system.html">Agent System</a></li>
<li class="toctree-l1"><a class="reference internal" href="orchestration_flow.html">Orchestration Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="tool_system.html">Tool System</a></li>
<li class="toctree-l1"><a class="reference internal" href="knowledge_and_skills.html">Knowledge and Skills System</a></li>
<li class="toctree-l1"><a class="reference internal" href="llm_integration.html">LLM Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">MCP Integration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mcp-client">MCP Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mcp-server">MCP Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mcp-agent">MCP Agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mcp-in-manus-agent">MCP in Manus Agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-with-mcp">Running with MCP</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sandbox_system.html">Sandbox System</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="configuration.html" title="previous chapter">Configuration</a></li>
      <li>Next: <a href="sandbox_system.html" title="next chapter">Sandbox System</a></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, FoundationAgents.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="_sources/mcp_integration.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>